---
配置Tomcat 管理界面layout: post
title:  "tomcat"
categories: middleware
tags: tomcat
author: joshua
description: tomcat
---
tomcat服务器：Apache公司研发，支持JavaEE的部分规范。开源免费。
weblogic服务器：Oracle公司提供，它支持JavaEE的所有规范，商用收费。
WebSphere服务器：IBM公司提供，它支持JavaEE的所有规范，商用收费。

[CATALINA_HOME  CATALINA_BASE](https://tomcat.apache.org/tomcat-9.0-doc/introduction.html)

**CATALINA_HOME**: Represents the root of your Tomcat installation
**CATALINA_BASE**: Represents the root of a runtime configuration of a specific Tomcat instance.
If you want to have **multiple** Tomcat instances on one machine, use the CATALINA_BASE property

By default, CATALINA_HOME and CATALINA_BASE point to the same directory. 

Set CATALINA_BASE manually when you require running **multiple** Tomcat instances on one machine. Doing so provides the following benefits:

```text
 Easier management of upgrading to a newer version of Tomcat. Because all instances with single CATALINA_HOME location share one set of .jar files and binary files, you can easily upgrade the files to newer version and have the change propagated to all Tomcat instances using the same CATALIA_HOME directory.
​ Avoiding duplication of the same static .jar files.
​ The possibility to share certain settings, for example the setenv shell or bat script file (depending on your operating system).
```

Contents of CATALINA_BASE
    **bin** directory with the setenv.sh, setenv.bat, and tomcat-juli.jar files.
        CATALINA_BASE is checked first; ==fallback== is provided to CATALINA_HOME.
    **lib** directory with further resources to be added on classpath.
        CATALINA_BASE is checked first; CATALINA_HOME is loaded ==second==.
    **logs** directory for instance-specific log files.
    **webapps** directory for automatically loaded web applications.
        CATALINA_BASE ==only==.
    **work** directory that contains temporary working directories for the deployed web applications.
    **temp** directory used by the JVM for temporary files.

At **minimum**, CATALINA_BASE must contain:

```text
conf/server.xml
conf/web.xml
```



#### [java要求](https://tomcat.apache.org/tomcat-9.0-doc/RUNNING.txt)

Tomcat 8.5 要求 JDK 版本为 1.7 以上
Tomcat 9.0 requires a Java Standard Edition Runtime Environment (JRE) version 8 or later.

#### [java下载](http://www.oracle.com/technetwork/java/javase/downloads/index.html)

You may also use a full Java Development Kit (JDK) rather than just a JRE.



### [tomcat下载 https://tomcat.apache.org/](https://tomcat.apache.org/)

As an alternative to downloading a **binary** distribution, you can create your own from the Tomcat ==source== code, as described in "==BUILDING.txt=="

```text
(3.1) Set CATALINA_HOME (required) and CATALINA_BASE (optional)
(3.2) Set JRE_HOME or JAVA_HOME (required)
(3.3) Other variables (optional)    CATALINA_OPTS JAVA_OPTS CATALINA_PID
(3.4) Using the "setenv" script (optional, recommended)
    By default the setenv script file is absent. If the script file is present
    On Windows, %CATALINA_BASE%\bin\setenv.bat:
        set "JRE_HOME=%ProgramFiles%\Java\jre8"
        exit /b 0
    $CATALINA_BASE/bin/setenv.sh:
        JRE_HOME=/usr/java/latest
        CATALINA_PID="$CATALINA_BASE/tomcat.pid"
```

```sh
%CATALINA_HOME%\bin\startup.bat
%CATALINA_HOME%\bin\catalina.bat start
$CATALINA_HOME/bin/startup.sh
$CATALINA_HOME/bin/catalina.sh start
http://localhost:8080/

%CATALINA_HOME%\bin\shutdown.bat
%CATALINA_HOME%\bin\catalina.bat stop
$CATALINA_HOME/bin/shutdown.sh
$CATALINA_HOME/bin/catalina.sh stop
```

####  **In CATALINA_BASE:**

* bin  - Only the following files:
        * setenv.sh (*nix) or setenv.bat (Windows),
        * tomcat-juli.jar
             The setenv scripts were described above. The tomcat-juli library is documented in the Logging chapter in the User Guide.
* conf - Server configuration files (including server.xml)
* lib  - Libraries and classes, as explained below
* logs - Log and output files
* webapps - Automatically loaded web applications
* work - Temporary working directories for web applications
* temp - Directory used by the JVM for temporary files (java.io.tmpdir)

#### In CATALINA_HOME:
* bin  - Startup and shutdown scripts
         The following files will be used only if they are absent in CATALINA_BASE/bin:
         setenv.sh (*nix), setenv.bat (Windows), tomcat-juli.jar
* lib  - Libraries and classes, as explained below
* endorsed - Libraries that override standard "Endorsed Standards"
             libraries provided by JRE. See Classloading documentation in the User Guide for details.
             This is only supported for Java <= 8. By default this "endorsed" directory is absent.



```text
It might be useful to note that the values of CATALINA_HOME and CATALINA_BASE can be referenced in the XML configuration files processed by Tomcat as ${catalina.home} and ${catalina.base} respectively.
```

#### manager
the standard manager web application can be kept in CATALINA_HOME/webapps/manager and loaded into CATALINA_BASE by using the following trick:

```sh
cp CATALINA_HOME/webapps/manager/META-INF/context.xml file CATALINA_BASE/conf/Catalina/localhost/manager.xml
```

```xml
        <?xml version="1.0" encoding="UTF-8"?>
        <Context docBase="${catalina.home}/webapps/manager"
            antiResourceLocking="false" privileged="true" >
            <Valve className="org.apache.catalina.valves.RemoteAddrValve"
                allow="127\.0\.0\.1" />
        </Context>
```

```sh
cp webapps/host-manager/META-INF/context.xml conf/Catalina/localhost/host-manager.xml
```

```xml
allow="127\.\d+\.\d+\.\d+|::1|0:0:0:0:0:0:0:1|192\.168\.118\.1" />
```



#### [server.xml配置文件中三个端口的作用](https://blog.csdn.net/u012031380/article/details/77839586)

protocol: HTTP/1.1 协议 ，用于监听浏览器发送的请求. 设置成80 后可以直接使用http://localhost 访问
AJP/1.3   协议 ， 用于监听其他服务器转发过来的请求.
redirectPort: 如果发送的是https 请求. 就将请求转发到8443 端口.

```xml
    <Connector port="8080" protocol="HTTP/1.1"
        connectionTimeout="20000"
        redirectPort="8443" />
<!-- 使用8009 接受其他服务器转发过来的请求 -->
    <Connector port="8009" protocol="AJP/1.3" redirectPort="8443" />
<!-- tomcat 监听的关闭端口 -->
<Server port="8005" shutdown="SHUTDOWN">

```

AJP（Apache JServ Protocol）是定向包协议。因为性能原因，使用二进制格式来传输可读性文本。WEB服务器通过 TCP连接 和 SERVLET容器连接

由于tomcat的html和图片解析功能相对其他服务器如apche等较弱，所以，一般都是集成起来使用，只有jsp和servlet服务交由tomcat处理，而tomcat和其他服务器的集成，就是通过ajp协议来完成的

<!--注释内容-->
注释可以出现在文档序言中，包括文档类型定义 (DTD)；文档之后；或文本内容中。 
注释不能出现在属性值中。 不能出现在标记中。
分析器在遇到 > 时，就认为注释已结束；然后继续将文档作为正常的 XML 处理。 因此，字符串 > 不能出现在注释中
以下注释可以用于暂时除去标记。
    <!--- <test pattern="SECAM" /><test pattern="NTSC" /> -->



#### [Tomcat连接池数据库密码加密](https://blog.csdn.net/fzzsh/article/details/8863338)





#### [Tomcat 快速入门](https://www.cnblogs.com/jingmoxukong/p/8258837.html)

Tomcat 是由 Apache 开发的一个 Servlet 容器，实现了对 Servlet 和 JSP 的支持，并提供了作为Web服务器的一些特有功能，如Tomcat管理和控制平台、安全域管理和Tomcat阀等。
由于 Tomcat 本身也内含了一个 HTTP 服务器，它也可以被视作一个单独的 Web 服务器。
Tomcat 包含了一个配置管理工具，也可以通过编辑XML格式的配置文件来进行配置

Apache HTTP 服务器是一个用 C 语言实现的 HTTP Web 服务器

##### 一般 web 项目路径结构

```
|-- webapp                         # 站点根目录
    |-- META-INF                   # META-INF 目录
    |   `-- MANIFEST.MF            # 配置清单文件
    |-- WEB-INF                    # WEB-INF 目录
    |   |-- classes                # class文件目录
    |   |   |-- *.class            # 程序需要的 class 文件
    |   |   `-- *.xml              # 程序需要的 xml 文件
    |   |-- lib                    # 库文件夹
    |   |   `-- *.jar              # 程序需要的 jar 包
    |   `-- web.xml                # Web应用程序的部署描述文件
    |-- <userdir>                  # 自定义的目录
    |-- <userfiles>                # 自定义的资源文件
```

`webapp`：工程发布文件夹。其实每个 war 包都可以视为 webapp 的压缩包。
`META-INF`：META-INF 目录用于存放工程自身相关的一些信息，元文件信息，通常由开发工具，环境自动生成。
`WEB-INF`：Java web应用的安全目录。所谓安全就是客户端无法访问，只有服务端可以访问的目录。
`/WEB-INF/classes`：存放程序所需要的所有 Java class 文件。
`/WEB-INF/lib`：存放程序所需要的所有 jar 文件。
`/WEB-INF/web.xml`：web 应用的部署配置文件。它是工程中最重要的配置文件，它描述了 servlet 和组成应用的其它组件，以及应用初始化参数、安全管理约束等。

### Server

> Server 元素表示整个 Catalina servlet 容器。
>
> 因此，它必须是 `conf/server.xml` 配置文件中的根元素。它的属性代表了整个 servlet 容器的特性。

**属性表**

| 属性      | 描述                                                         | 备注                                         |
| --------- | ------------------------------------------------------------ | -------------------------------------------- |
| className | 这个类必须实现org.apache.catalina.Server接口。               | 默认 org.apache.catalina.core.StandardServer |
| address   | 服务器等待关机命令的TCP / IP地址。如果没有指定地址，则使用localhost。 |                                              |
| port      | 服务器等待关机命令的TCP / IP端口号。设置为-1以禁用关闭端口。 |                                              |
| shutdown  | 必须通过TCP / IP连接接收到指定端口号的命令字符串，以关闭Tomcat。 |                                              |

### Service

> Service元素表示一个或多个连接器组件的组合，这些组件共享一个用于处理传入请求的引擎组件。Server 中可以有多个 Service。

**属性表**

| 属性      | 描述                                                         | 备注                                            |
| --------- | ------------------------------------------------------------ | ----------------------------------------------- |
| className | 这个类必须实现`org.apache.catalina.Service`接口。            | 默认 `org.apache.catalina.core.StandardService` |
| name      | 此服务的显示名称，如果您使用标准 Catalina 组件，将包含在日志消息中。与特定服务器关联的每个服务的名称必须是唯一的。 |                                                 |

**实例 - `conf/server.xml` 配置文件示例**

```xml
<?xml version="1.0" encoding="UTF-8"?>
<Server port="8005" shutdown="SHUTDOWN">
  <Service name="xxx">
  ...
  </Service>
</Server>
```

### Executor

> Executor表示可以在Tomcat中的组件之间共享的线程池。

**属性表**

| 属性            | 描述                                                         | 备注                                                   |
| --------------- | ------------------------------------------------------------ | ------------------------------------------------------ |
| className       | 这个类必须实现`org.apache.catalina.Executor`接口。           | 默认 `org.apache.catalina.core.StandardThreadExecutor` |
| name            | 线程池名称。                                                 | 要求唯一, 供Connector元素的executor属性使用            |
| namePrefix      | 线程名称前缀。                                               |                                                        |
| maxThreads      | 最大活跃线程数。                                             | 默认200                                                |
| minSpareThreads | 最小活跃线程数。                                             | 默认25                                                 |
| maxIdleTime     | 当前活跃线程大于minSpareThreads时,空闲线程关闭的等待最大时间。 | 默认60000ms                                            |
| maxQueueSize    | 线程池满情况下的请求排队大小。                               | 默认Integer.MAX_VALUE                                  |

```xml
<Service name="xxx">
  <Executor name="tomcatThreadPool" namePrefix="catalina-exec-" maxThreads="300" minSpareThreads="25"/>
</Service>
```

### Connector

> Connector代表连接组件。Tomcat 支持三种协议：HTTP/1.1、HTTP/2.0、AJP。

**属性表**

| 属性                  | 说明                                                         | 备注                                                         |
| --------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| asyncTimeout          | Servlet3.0规范中的异步请求超时                               | 默认30s                                                      |
| port                  | 请求连接的TCP Port                                           | 设置为0,则会随机选取一个未占用的端口号                       |
| protocol              | 协议. 一般情况下设置为 HTTP/1.1,这种情况下连接模型会在NIO和APR/native中自动根据配置选择 |                                                              |
| URIEncoding           | 对URI的编码方式.                                             | 如果设置系统变量org.apache.catalina.STRICT_SERVLET_COMPLIANCE为true,使用 ISO-8859-1编码;如果未设置此系统变量且未设置此属性, 使用UTF-8编码 |
| useBodyEncodingForURI | 是否采用指定的contentType而不是URIEncoding来编码URI中的请求参数 |                                                              |

以下属性在标准的Connector(NIO, NIO2 和 APR/native)中有效:

| 属性              | 说明                                                         | 备注                                                         |
| ----------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| acceptCount       | 当最大请求连接maxConnections满时的最大排队大小               | 默认100,注意此属性和Executor中属性maxQueueSize的区别.这个指的是请求连接满时的堆栈大小,Executor的maxQueueSize指的是处理线程满时的堆栈大小 |
| connectionTimeout | 请求连接超时                                                 | 默认60000ms                                                  |
| executor          | 指定配置的线程池名称                                         |                                                              |
| keepAliveTimeout  | keeAlive超时时间                                             | 默认值为connectionTimeout配置值.-1表示不超时                 |
| maxConnections    | 最大连接数                                                   | 连接满时后续连接放入最大为acceptCount的队列中. 对 NIO和NIO2连接,默认值为10000;对 APR/native,默认值为8192 |
| maxThreads        | 如果指定了Executor, 此属性忽略;否则为Connector创建的内部线程池最大值 | 默认200                                                      |
| minSpareThreads   | 如果指定了Executor, 此属性忽略;否则为Connector创建线程池的最小活跃线程数 | 默认10                                                       |
| processorCache    | 协议处理器缓存Processor对象的大小                            | -1表示不限制.当不使用servlet3.0的异步处理情况下: 如果配置Executor,配置为Executor的maxThreads;否则配置为Connnector的maxThreads. 如果使用Serlvet3.0异步处理, 取maxThreads和maxConnections的最大值 |

### Context

> Context元素表示一个Web应用程序，它在特定的虚拟主机中运行。每个Web应用程序都基于Web应用程序存档（WAR）文件，或者包含相应的解包内容的相应目录，如Servlet规范中所述。

**属性表**

| 属性                       | 说明                                                         | 备注                                           |
| -------------------------- | ------------------------------------------------------------ | ---------------------------------------------- |
| altDDName                  | web.xml部署描述符路径                                        | 默认 /WEB-INF/web.xml                          |
| docBase                    | Context的Root路径                                            | 和Host的appBase相结合, 可确定web应用的实际目录 |
| failCtxIfServletStartFails | 同Host中的failCtxIfServletStartFails, 只对当前Context有效    | 默认为false                                    |
| logEffectiveWebXml         | 是否日志打印web.xml内容(web.xml由默认的web.xml和应用中的web.xml组成) | 默认为false                                    |
| path                       | web应用的context path                                        | 如果为根路径,则配置为空字符串(""), 不能不配置  |
| privileged                 | 是否使用Tomcat提供的manager servlet                          |                                                |
| reloadable                 | /WEB-INF/classes/ 和/WEB-INF/lib/ 目录中class文件发生变化是否自动重新加载 | 默认为false                                    |
| swallowOutput              | true情况下, System.out和System.err输出将被定向到web应用日志中 | 默认为false                                    |

### Engine

> Engine元素表示与特定的Catalina服务相关联的整个请求处理机器。它接收并处理来自一个或多个连接器的所有请求，并将完成的响应返回给连接器，以便最终传输回客户端。

**属性表**

| 属性        | 描述                                                         | 备注                                                         |
| ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| defaultHost | 默认主机名，用于标识将处理指向此服务器上主机名称但未在此配置文件中配置的请求的主机。 | 这个名字必须匹配其中一个嵌套的主机元素的名字属性。           |
| name        | 此引擎的逻辑名称，用于日志和错误消息。                       | 在同一服务器中使用多个服务元素时，每个引擎必须分配一个唯一的名称。 |

### Host

> Host元素表示一个虚拟主机，它是一个服务器的网络名称（如“www.mycompany.com”）与运行Tomcat的特定服务器的关联。

**属性表**

| 属性                       | 说明                                                         | 备注                                         |
| -------------------------- | ------------------------------------------------------------ | -------------------------------------------- |
| name                       | 名称                                                         | 用于日志输出                                 |
| appBase                    | 虚拟主机对应的应用基础路径                                   | 可以是个绝对路径, 或${CATALINA_BASE}相对路径 |
| xmlBase                    | 虚拟主机XML基础路径,里面应该有Context xml配置文件            | 可以是个绝对路径, 或${CATALINA_BASE}相对路径 |
| createDirs                 | 当appBase和xmlBase不存在时,是否创建目录                      | 默认为true                                   |
| autoDeploy                 | 是否周期性的检查appBase和xmlBase并deploy web应用和context描述符 | 默认为true                                   |
| deployIgnore               | 忽略deploy的正则                                             |                                              |
| deployOnStartup            | Tomcat启动时是否自动deploy                                   | 默认为true                                   |
| failCtxIfServletStartFails | 配置为true情况下,任何load-on-startup >=0的servlet启动失败,则其对应的Contxt也启动失败 | 默认为false                                  |

### Cluster



#### [官方文档](https://tomcat.apache.org/tomcat-9.0-doc/index.html)

[Configuration](https://tomcat.apache.org/tomcat-9.0-doc/config/index.html)





### [centos7下安装tomcat8.0](https://blog.csdn.net/xiaobaoxiaodun/article/details/53539680)

firewall-cmd –zone=public –add-port=8080/tcp –permanent

设置服务开机启动
因为centos7使用了systemd来管理服务，所以按以下步骤来设置
1、vi /etc/systemd/system/tomcat.service

```text
[unit]
Description=Apache Tomcat Web Application Container
After=network.target
[Service]
Type=forking
ExecStart=/opt/apache-tomcat-8.5.8/bin/startup.sh
ExecStop=/opt/apache-tomcat-8.5.8/bin/shutdown.sh
[Install]
WantedBy=multi-user.target
```

2、将tomcat设为开机启动：
systemctl enable tomcat

3、启动tomcat:
systemctl start tomcat

4、查询当前tomcat的状态
systemctl status tomcat

5、关闭tomcat:
systemctl stop tomcat





####  [centos7中使用yum安装tomcat](https://www.cnblogs.com/qianzf/p/6986962.html)

JAVA_OPTS="-Djava.security.egd=file:/dev/./urandom -Djava.awt.headless=true -Xmx512m -XX:MaxPermSize=256m -XX:+UseConcMarkSweepGC"



#### [项目打成war包并用tomcat部署](https://blog.csdn.net/zhanglf02/article/details/73565354/)

1.最简单，常见的部署方法，直接将war包放到tomcat的wabapp目录下，运行tomcat就行
2.将项目打包到本地随便一个目录位置，然后用tomcat部署该项目
F:\TomcatAppTest的文件夹，并将war包放到这里
server.xml

```xml
    <Host name="localhost"  appBase="webapps"
        unpackWARs="true" autoDeploy="true">
        <Context path="/tsqa" docBase ="F:/TomcatAppTest/tsqa" reloadable ="true" />
    </Host>
```

path:启动项目后访问的项目名 
docBase:该项目的实际放置位置的路径，注意到项目名称这一级而不是文件夹名这一级。 

使用cmd命令: jar -cvf tsqa.war tsqa 打包项目，不建议使用,打包的目录结构和用eclips打包的目录结构不同，且打的包更重，结构不合理。





#### [Tomcat下使用war包发布项目](https://www.cnblogs.com/george93/p/7478756.html)

**一、静态部署**

 静态部署指的是我们在服务器启动之前部署我们的程序，只有当服务器启动之后，我们的Web应用程序才能访问。

以下3种方式都可以部署：（以PetWeb项目为例说明，PetWeb目录假设是F:/PetWeb）

1.**利用Tomcat自动部署**

 将PetWeb目录拷贝到$CATALINA_HOME/webapps下，然后启动服务器就可以了，Tomcat启动时将自动加载应用。

访问地址如下：http://localhost:8080/PetWeb/

这种方式比较简单，但是web应用程序必须在webapps目录下。Tomcat的Webapps目录是Tomcat默认的应用目录，当服务器启动时，会加载所有这个目录下的应用。

**2.修改Server.xml文件部署**

这种方式可以不必将PetWeb目录拷贝到webapps下，直接在F:/部署。方法如下，更改$CATALINA_HOME/conf/server.xml文件，

```xml
<Context  path ="/Pet"  reloadable ="false"  docBase ="F:/PetWeb"  workDir ="d:/Mywebapps/emp"  />
```

path：是访问时的根地址，表示访问的路径；如上述例子中，访问该应用程序地址如下：http://localhost:8080/Pet/

reloadable：表示可以在运行时在classes与lib文件夹下自动加载类包。其中reloadable="false"表示当应用程序 中的内容发生更改之后服务器不会自动加载，这个属性在开发阶段通常都设为true，方便开发，在发布阶段应该设置为false，提高应用程序的访问速度。

docbase：表示应用程序的路径，注意斜杠的方向“/”。 docBase可以使用绝对路径，也可以使用相对路径，相对路径相对于webapps。

workdir：表示缓存文件的放置地址

**3.增加自定义web部署文件(推荐使用，不需要重启Tomcat )**

这种方式和方法2差不多，但不是在Server.xml文件中添加Context标签，而是在$CATALINA_HOME/conf /Catalina/localhost中添加一个xml文件，如Pet.xml.在Tomcat安装目录conf/Catalina /localhost下，里面有Tomcat自带的三个应用，随意复制其中的一个XML文件，然后修改docbase指向你自己的应用程序，并把文件名改 名，各参数参见方法2中的<Context>标签的参数，或者你也可以自己新建一个XML文件。(注意此文件名将作为Context中的path属性值,不管文件里的path属性值如何设置也是无效的 )，将以下内容复制过去，修改相应路径即可。

```xml
<Context  path ="/Pet"  docBase ="F:/PetWeb"  
        debug ="0"  privileged ="true"  reloadable ="false"  >  
</Context>
```

访问地址如下：[http://localhost:8080/Pet/ ](http://localhost:8080/Pet/) 

**注： Web应用以.war文件的形式部署**

可以将JSP程序打包成一个war包放在目录下，服务器会自动解开这个war包，并在这个目录下生成一个同名的文件夹。一个war包就是有特性格式的jar包，它是将一个Web程序的所有内容进行压缩得到。

我们刚才是将PetWeb文件夹部署在了服务器中，我们知道可以将Web应用程序的内容打成.war 包，然后在部署在服务器上。打包请参考如下步骤： 
  1、打开命令提示符（cmd） 
  2、设置jdk环境变量 
  3、在命令提示符中进入项目文件夹F:/PetWeb后，键入如下命令：**jar cvf Pet.war \*/ .**  （注意最后有个“. ”）。这样在F:/PetWeb下应该有Pet.war文件。 （也可以打包到指定的地方，命令如下：**jar cvf d:/Pet.war \*/ .** ）

部署Pet.war文件非常简单，将刚才xml文件中的docBase ="F:/PetWeb" 更改为docBase ="F:/Pet.war" 或者直接将其拷贝到webapps目录下就可以。然后重新启动服务器就可以将Pet.war部署为一个Web应用程序了。

如果你够细心的话你会发现，服务器将Pet.war文件解开，并且在webapps下面又生成了一个Pet文件夹，然后把Pet.war的内容拷贝到里面去了。我们可以通过以下方式取消自动解压缩，将xml配置文件中的unpackWAR 属性设置为"false" 即可。



**二、动态部署**

动态部署是指可以在服务器启动之后部署web应用程序，而不用重新启动服务器。动态部署要用到服务器提供的manager.war文件，如果 在$CATALINA_HOME/webapps/下没有该文件，你必须去重新下载tomcat，否则不能完成以下的功能。要想使用该管理程序必须首先编 辑$CATALINA_HOME/conf/tomcat-users.xml文件，内容如下：（关于这个文件的更多内容，请参考 [Java Web应用程序的安全模型二 ](http://coresun.blog.sohu.com/70550348.html)）

```xml
<tomcat-users> 
    <role rolename="tomcat"/> 
    <role rolename="role1"/> 
    <role rolename="manager"/> 
    <user username="coresun" password="coresun" roles="manager"/> 
    <user username="tomcat" password="tomcat" roles="tomcat"/> 
    <user username="both" password="tomcat" roles="tomcat,role1"/> 
    <user username="role1" password="tomcat" roles="role1"/> 
</tomcat-users>
```

然后在浏览器中键入如下地址：[http://localhost:8080/ ](http://localhost:8080/)，应该看到一个加菲猫了吧。点击左边的Tomcat Manager链接，提示输入用户名和密码，本文都是coresun ，然后可以看到以下页面：

![img](http://hi.csdn.net/attachment/201003/22/2504700_12692438796qfN.jpg)

(1)Context Path(option): 中输入/Pet


(2)XML Configration file URL 中要指定一个.xml文件，比如我们在F:/下建立一个Pet.xml文件，内容如下：** reloadable ="false" ***\*/\** >** 。docBase 不用写了，因为要在下一个文本框中填入。或者更简单点，这个文本框什么都不填。


(3)WAR or Directory URL: 中键入F:/PetWet或者F:/Pet.war都可以，然后点击Deploy按钮，看看上面是不是已经看到了你web应用程序，名字就是你Context Path(option):中的名字。


(4)如果你部署.war文件还有更加简单的方式，下面还有个Select WAR file upload 点击浏览选择.war文件，然后点击Deploy也可以。

 

 

 

**让tomcat只运行conf/server.xml中指定的web应用**

可以有以下2种办法：

实现一: 

1)将要部署的WEB应用放在webapps以外的路径, 并在server.xml相应的**Context** 中的docBase 指定. 

2)删除webapps中的所有文件夹, 以及conf/catalina/localhost下所有xml文件. 
注: webapps是server.xml中的**Host** 元素的appBase 属性的值.

实现二: 

修改server.xml中**Host** 元素的属性, 添加或修改: deployXML ="false" deployOnStartup ="false" autoDeploy="false"

含义: 
   deployXML ="false" : 不部署conf/catalina/localhost下的xml相应的WEB应用

   deployOnStartup ="false" :tomcat启动时, 不部署webapps下的所有web应用

   autoDeploy ="false" :避免tomcat在扫描改动时, 再次把webapps下的web应用给部署进来.

**注：**

Tomcat中webapps目录下不能直接存放网页格式的文件，否则无法访问到该文件，必须有子目录才能访问该网页文件。
例如：我们直接将index.html放在webapps目录中，通过浏览器http://localhost:8080/index.html 是无法访问到index.html的。而必须要webapps/petweb/index.html才可以通过http://localhost:8080/petweb/index.html 访问到index.html页面。



#### [为Tomcat创建systemd unit 文件](https://blog.csdn.net/default7/article/details/54925702)

```sh
[Unit]
Description=Apache Tomcat Web Application Container
After=syslog.target network.target

[Service]
Type=forking

Environment=JAVA_HOME=/usr/lib/jvm/jre
Environment=CATALINA_PID=/opt/tomcat/temp/tomcat.pid
Environment=CATALINA_HOME=/opt/tomcat
Environment=CATALINA_BASE=/opt/tomcat
Environment='CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC'
Environment='JAVA_OPTS=-Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom'

ExecStart=/opt/tomcat/bin/startup.sh
ExecStop=/bin/kill -15 $MAINPID

User=tomcat
Group=tomcat

[Install]
WantedBy=multi-user.target
```

##### 配置Tomcat 管理界面

/opt/tomcat/conf/tomcat-users.xml

```xml
<user username="yourusername" password="yourpassword" roles="manager-gui,admin-gui"/>
```





#### [Tomcat 安全配置与优化](https://blog.csdn.net/qq_22980667/article/details/81006883) 

2.1优化server.xml
2.1.1 隐藏版本信息
隐藏HTTP 头部的版本信息 。
编辑server.xml: vi /usr/local/tomcat8/conf/server.xml
为Connector 添加 server 属性

```xml
<Connector port="8080" protocol="HTTP/1.1"  connectionTimeout="20000"  redirectPort="8443" server="APP Srv1.0"/>    
```

隐藏404页面出现的版本号
![这里写图片描述](https://img-blog.csdn.net/2018042011012210?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2pramtqa2xs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)
针对该信息的显示是由一个jar包控制的，该jar包存放在 Tomcat 安装目录下的lib目录下，名称为 catalina.jar。
我们可以通过 jar xf 命令解压这个 jar 包会得到两个目录 META-INF 和 org ,通过修改 org/apache/catalina/util/ServerInfo.properties 文件中 的 serverinfo 字段来实现来更改我们tomcat的版本信息。

```sh
[root@localhost ~]#  cat /usr/local/tomcat8/lib/org/apache/catalina/util/ServerInfo.properties |grep -v '^$|#'
server.info=Apache Tomcat/8.0.23
server.number=8.0.23.0
server.built=Mar 18 2016 20:31:49 UTC
还有另外一种方法来实现隐藏或伪装Tomcat的版本信息，其本质和上面一样，操作如下：
[root@localhost ~]# cd /usr/local/tomcat8/lib
[root@localhost lib]# mkdir -p org/apache/catalina/util
[root@localhost lib]# cd org/apache/catalina/util
[root@localhost util]# vim ServerInfo.properties
server.info=nolinux        # 如果想修改成其它版本号，把这个地方的值改成其它值就行了
```

修改效果如下：
![这里写图片描述](https://img-blog.csdn.net/20180420110253987?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2pramtqa2xs/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70)

2.1.2 禁用Tomcat管理界面
生产环境一般不适用Tomcat默认的管理界面，这些页面存放在Tomcat 的webapps安装目录下，
把该目录下的所有文件删除即可：rm -rf /usr/local/tomcat8/webapps/*
另外删除相关的配置文件 host-manager.xml 和 manager.xml，在Tomcat 安装目录 conf/Catalina/localhost目录下。
注释或删除tomcat_user.xml 中的所有用户权限。
2.1.3 应用程序安全
tomcat默认 开启了对war热部署。为了防止被植入木马恶意攻击，我们要关闭war包自动部署。
关闭自动加载最新代码（设置reloadable）
修改实例：

```xml
    <Host name="localhost"  appBase="webapps"    
  unpackWARs="false" autoDeploy="false"     
   reloadable="false">  
```

2.1.4 更改关闭Tomcat的指令
server.xml中定义了可以直接关闭 Tomcat 实例的管理端口。我们通过 telnet 连接上该端口之后，输入 SHUTDOWN （此为默认关闭指 令）即可关闭 Tomcat 实例（注意，此时虽然实例关闭了，但是进程还是存在的）。由于默认关闭 Tomcat 的端口和指令都很简单。默认端口为 8005，指令为SHUTDOWN 。因此我们需要将关闭指令修改复杂一点。
当然，在新版的 Tomcat 中该端口仅监听在127.0.0.1上，因此大家也不必担心。除非黑客登陆到tomcat本机去执行关闭操作。
修改实例：

```xml
     <Server port="8005" shutdown="9SDKJ29jksjf23sjf0LSDF92JKS9DKkjsd">
```

或者禁用8005端口

```xml
     <Server port="-1" shutdown="SHUTDOWN">
```

2.1.5 连接池配置
使用线程池，用较少的线程处理较多的访问，可以提高tomcat处理请求的能力。
编辑配置文件 server.xml : vi /usr/local/tomcat8/conf/server.xml
2.1.5.1 打开被注释的默认连接池配置
默认配置：

```xml
    <!--  
             <Executor name="tomcatThreadPool" namePrefix="catalina-exec-"  
                    maxThreads="150" minSpareThreads="4"/>  
                 -->  
```

修改实例：

```xml
<Executor name="tomcatThreadPool" namePrefix="catalina-exec-"  
            maxThreads="150" minSpareThreads="100"   
        prestartminSpareThreads="true" maxQueueSize="100"/> 
```

参数讲解：
name: 线程名称
namePrefix: 线程前缀
maxThreads : 最大并发连接数，不配置时默认200，一般建议设置500~ 800 ，要根据自己的硬件设施条件和实际业务需求而定。
minSpareThreads：Tomcat启动初始化的线程数，默认值25
prestartminSpareThreads：在tomcat初始化的时候就初始化minSpareThreads的值， 不设置true时minSpareThreads
maxQueueSize: 最大的等待队列数，超过则拒绝请求

2.1.5.2 修改链接配置

默认配置：

```
<Connector port="8080" protocol="HTTP/1.1"  



              connectionTimeout="20000"  



              redirectPort="8443" /> 
```

- 1
- 2
- 3

修改配置：

```
<Connector port="8080" protocol="org.apache.coyote.http11.Http11Nio2Protocol"  



        connectionTimeout="20000"  



        redirectPort="8443"   



        executor="tomcatThreadPool"  



        enableLookups="false"   



        acceptCount="100"   



        maxPostSize="10485760"   



        compression="on"   



        disableUploadTimeout="true"   



        compressionMinSize="2048"   



        noCompressionUserAgents="gozilla, traviata"   



        acceptorThreadCount="2"   



        compressableMimeType="text/html,text/xml,text/plain,text/css,text/javascript,application/javascript"   



        URIEncoding="utf-8"/>  
```

参数讲解：
port：连接端口。
protocol：连接器使用的传输方式。 Tomcat 8 设置 nio2 更好：org.apache.coyote.http11.Http11Nio2Protocol
protocol， Tomcat 6、7 设置 nio 更好：org.apache.coyote.http11.Http11NioProtocol
注：
每个web客户端请求对于服务器端来说就一个单独的线程，客户端的请求数量增多将会导致线程数就上去了，CPU就忙着 跟线程切换。
而NIO则是使用单线程(单个CPU)或者只使用少量的多线程(多CPU)来接受Socket，而由线程池来处理堵塞在pipe 或者队 列里的请求.这样的话，只要OS可以接受TCP的连接，web服务器就可以处理该请求。大大提高了web服务器的可伸缩性。
executor： 连接器使用的线程池名称
enableLookups：禁用DNS 查询
acceptCount：指定当所有可以使用的处理请求的线程数都被使用时，可以放到处理队列中的请求数，超过这个数的请求将不予处理，默认设置 100 。
maxPostSize：限制 以FORM URL 参数方式的POST请求的内容大小，单位字节，默认是 2097152(2兆)，10485760 为 10M。如果要禁用限制，则可以设置为 -1。
acceptorThreadCount： 用于接收连接的线程的数量，默认值是1。一般这个指需要改动的时候是因为该服务器是一个多核CPU，如果是多核 CPU 一般配置为 2。
compression：传输时是压缩。
compressionMinSize：压缩的大小
noCompressionUserAgents：不启用压缩的浏览器
提示：
压缩会增加Tomcat负担，最好采用Nginx + Tomcat 或者 Apache + Tomcat 方式，压缩交由Nginx/Apache 去做。
Tomcat 的压缩是在客户端请求服务器对应资源后，从服务器端将资源文件压缩，再输出到客户端，由客户端的浏览器负责解压缩并浏览。相对于普通的 浏览过程 HTML、CSS、Javascript和Text，它可以节省40% 左右的流量。更为重要的是，它可以对动态生成的，包括CGI、PHP、JSP、ASP、Servlet,SHTML等输出的网页也能进行压缩，压缩效率也很高。

2.1.6 管理AJP端口
AJP是为 Tomcat 与 HTTP 服务器之间通信而定制的协议，能提供较高的通信速度和效率。如果tomcat前端放的是apache的时候，会使用到AJP这个连接 器。 默认是开启的。如果不使用apache，注释该连接器。
实例：

```
       <Connector port="8009" protocol="AJP/1.3" redirectPort="8443" />--></span>  
```

- 1

2.2 JVM
推荐阅读：https://github.com/judasn/Linux-Tutorial/blob/master/Tomcat-Install-And-Settings.md

2.3 应用程序部署
默认tomcat是root身份运行的，这样不安全。不要使用root用户启动tomcat。Java程序与C程序不同。nginx,httpd 使用root用户启动守护80端口，子进程/线程会通过setuid(),setgid()两个函数切换到普通用户。即父进程所有者是root用户，子进程与多线程所有者是一个非root用户，这个用户没有shell，无法通过ssh与控制台登陆系统，Java 的JVM 是与系统无关的，是建立在OS之上的，你使用什么用户启动Tomcat，那麽Tomcat 就会继承该所有者的权限。为了防止 Tomcat 被植入 web shell 程序后，可以修改项目文件。因此我们要将 Tomcat 和项目的属主做分离，这样子，即便被搞，他也无法创建和编辑项目文件。
设置普通用户，用来启动tomcat

```
[root@localhost ~]# groupadd tomcat



[root@localhost ~]# useradd -g tomcat tomcat



[root@localhost ~]# passwd tomcat



[root@localhost ~]# chown tomcat.tomcat -R /usr/local/tomcat



[root@localhost ~]# su - tomcat /usr/local/tomcat/bin/startup.sh



[root@localhost ~]# echo 'su - tomcat -c "tomcat /usr/local/tomcat/bin/startup.sh"' >> /etc/rc.local  #开机启动
```

